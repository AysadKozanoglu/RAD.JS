/**
 * RAD.js
 * v.0.93b development version
 * Mobidev.biz
 * Date: 02/18/14
 */
(function(a,d){function b(a,b,e){"function"===typeof a&&(e&&e instanceof Object?a.apply(e,b):a(b))}function h(a,b){var e=a.split("."),f=d.RAD,g,k;"RAD"===e[0]&&(e=e.slice(1));g=e.length;for(k=0;k<g;k+=1)void 0===f[e[k]]&&(f[e[k]]=k===g-1?b:{}),f=f[e[k]];return f}function m(a,b){var e;a.classList&&a.classList.contains(b)?e=a:a.parentNode&&(e=m(a.parentNode,b));return e}function l(a){var b=this.scrollTracker;(!b.scrollView||b.scrollRequest&&(a.touches[0].screenY>b.startIOSTouch&&0===b.scrollView.scrollTop||
    b.scrollView.scrollTop>=b.scrollEnd&&a.touches[0].screenY<b.startIOSTouch))&&a.preventDefault()}function c(a){var b=this.scrollTracker=this.scrollTracker||{};b.scrollView=m(a.target,"native-scroll");b.scrollRequest=!1;b.scrollView&&(b.startIOSTouch=a.touches[0].screenY,b.scrollRequest=!0,b.scrollEnd=b.scrollView.firstElementChild.offsetHeight-b.scrollView.offsetHeight)}function p(){function b(a){a.stopPropagation();a.preventDefault()}var s=navigator.userAgent.match(/(iPad|iPhone|iPod|iOS)/gi)?!0:
    !1,e=/android/gi.test(d.navigator.appVersion),f=a.querySelector("#overlay"),g=a.createElement("style");g.appendChild(a.createTextNode('body,html{position:relative;height:100%;overflow:hidden;-ms-touch-action:none;-ms-touch-select:none}body{margin:0;-webkit-touch-callout:none;-webkit-text-size-adjust:none;-webkit-highlight:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}a,abbr,acronym,address,applet,article,aside,audio,b,big,blockquote,body,canvas,caption,center,cite,code,dd,del,details,dfn,div,dl,dt,em,embed,fieldset,figcaption,figure,footer,form,h1,h2,h3,h4,h5,h6,header,hgroup,html,i,iframe,img,ins,kbd,label,legend,li,mark,menu,nav,object,ol,output,p,pre,q,ruby,s,samp,section,small,span,strike,strong,sub,summary,sup,table,tbody,td,tfoot,th,thead,time,tr,tt,u,ul,var,video{-moz-user-select:none;-o-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}a,button,input,textarea{-webkit-tap-highlight-color:rgba(0,0,0,0);-moz-user-select:text;-o-user-select:text;-khtml-user-select:text;-webkit-user-select:text;-ms-user-select:text;user-select:text}img{border-style:none}input,select,textarea{vertical-align:middle}fieldset,form{margin:0;padding:0;border-style:none}div[data-role=view]{position:absolute;top:0;left:0;width:100%;height:100%;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}#screen{position:relative;height:100%;overflow:hidden}#overlay{display:none;position:absolute;z-index:1000;left:0;top:0;width:100%;height:100%}#overlay.show{display:block}.lightbox{position:absolute;z-index:999;left:0;top:0;width:100%;height:100%;opacity:0;text-align:center;white-space:nowrap}.lightbox.animate{-webkit-transition:opacity 300ms ease;-moz-transition:opacity 300ms ease;-ms-transition:opacity 300ms ease;-o-transition:opacity 300ms ease;transition:opacity 300ms ease}.lightbox.show{opacity:1}.lightbox:after{content:"";display:inline-block;vertical-align:middle;width:1px;height:100%}.lightbox-frame{position:relative;display:inline-block;vertical-align:middle;width:100%;text-align:left;white-space:normal;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;-moz-transform:scale(0.5,.5);-webkit-transform:scale(0.5,.5);-o-transform:scale(0.5,.5);-ms-transform:scale(0.5,.5);transform:scale(0.5,.5)}.lightbox.animate>.lightbox-frame{-webkit-transition:-webkit-transform 300ms ease;-moz-transition:-moz-transform 300ms ease;-ms-transition:-ms-transform 300ms ease;-o-transition:-o-transform 300ms ease;transition:transform 300ms ease}.lightbox.show .lightbox-frame{-moz-transform:scale(1,1);-webkit-transform:scale(1,1);-o-transform:scale(1,1);-ms-transform:scale(1,1);transform:scale(1,1)}.toast{z-index:999;position:absolute;width:auto!important;max-width:50%!important;height:auto!important;opacity:0;text-align:center;display:inline-block}.toast.animate{-webkit-transition:opacity 300ms ease;-moz-transition:opacity 300ms ease;-ms-transition:opacity 300ms ease;-o-transition:opacity 300ms ease;transition:opacity 300ms ease}.toast.show{opacity:1}.popup{position:absolute;z-index:999;opacity:0}.popup.animate{-webkit-transition:opacity 300ms ease;-moz-transition:opacity 300ms ease;-ms-transition:opacity 300ms ease;-o-transition:opacity 300ms ease;transition:opacity 300ms ease}.popup.show{opacity:1}.jump-in,.jump-out,.slide-in,.slide-out{-webkit-transition:-webkit-transform 350ms ease;-moz-transition:-moz-transform 350ms ease;-ms-transition:-ms-transform 350ms ease;-o-transition:-o-transform 350ms ease;transition:transform 350ms ease}.new-page.slide-in{-webkit-transform:translate(100%,0) translateZ(0);-moz-transform:translate(100%,0) translateZ(0);-ms-transform:translate(100%,0) translateZ(0);-o-transform:translate(100%,0) translateZ(0);transform:translate(100%,0) translateZ(0)}.animate>.new-page.jump-in,.animate>.new-page.slide-in,.old-page.jump-in,.old-page.slide-in{-webkit-transform:translate(0,0) translateZ(0);-moz-transform:translate(0,0) translateZ(0);-ms-transform:translate(0,0) translateZ(0);-o-transform:translate(0,0) translateZ(0);transform:translate(0,0) translateZ(0)}.animate>.old-page.slide-in,.new-page.slide-out{-webkit-transform:translate(-100%,0) translateZ(0);-moz-transform:translate(-100%,0) translateZ(0);-ms-transform:translate(-100%,0) translateZ(0);-o-transform:translate(-100%,0) translateZ(0);transform:translate(-100%,0) translateZ(0)}.animate>.new-page.jump-out,.animate>.new-page.slide-out,.old-page.jump-out,.old-page.slide-out{-webkit-transform:translate(0,0) translateZ(0);-moz-transform:translate(0,0) translateZ(0);-ms-transform:translate(0,0) translateZ(0);-o-transform:translate(0,0) translateZ(0);transform:translate(0,0) translateZ(0)}.animate>.old-page.slide-out{-webkit-transform:translate(100%,0) translateZ(0);-moz-transform:translate(100%,0) translateZ(0);-ms-transform:translate(100%,0) translateZ(0);-o-transform:translate(100%,0) translateZ(0);transform:translate(100%,0) translateZ(0)}.new-page.jump-in{-webkit-transform:translate(0,100%) translateZ(0);-moz-transform:translate(0,100%) translateZ(0);-ms-transform:translate(0,100%) translateZ(0);-o-transform:translate(0,100%) translateZ(0);transform:translate(0,100%) translateZ(0)}.animate>.old-page.jump-in,.new-page.jump-out{-webkit-transform:translate(0,-100%) translateZ(0);-moz-transform:translate(0,-100%) translateZ(0);-ms-transform:translate(0,-100%) translateZ(0);-o-transform:translate(0,-100%) translateZ(0);transform:translate(0,-100%) translateZ(0)}.animate>.old-page.jump-out{-webkit-transform:translate(0,100%) translateZ(0);-moz-transform:translate(0,100%) translateZ(0);-ms-transform:translate(0,100%) translateZ(0);-o-transform:translate(0,100%) translateZ(0);transform:translate(0,100%) translateZ(0)}.new-page.fade-in,.new-page.fade-out{opacity:0;-webkit-transition:opacity 350ms ease;-moz-transition:opacity 350ms ease;-ms-transition:opacity 350ms ease;-o-transition:opacity 350ms ease;transition:opacity 350ms ease}.old-page.fade-in,.old-page.fade-out{opacity:1;-webkit-transition:opacity 175ms 175ms ease;-moz-transition:opacity 175ms 175ms ease;-ms-transition:opacity 175ms 175ms ease;-o-transition:opacity 175ms 175ms ease;transition:opacity 175ms 175ms ease}.animate>.new-page.fade-in,.animate>.new-page.fade-out{opacity:1}.animate>.old-page.fade-in,.animate>.old-page.fade-out{opacity:0}.native-scroll{overflow-y:scroll;-webkit-overflow-scrolling:touch}.native-scroll>div,.native-scroll>ol,.native-scroll>p,.native-scroll>ul{-webkit-transform:translate(0,0) translateZ(0);-moz-transform:translate(0,0) translateZ(0);-ms-transform:translate(0,0) translateZ(0);-o-transform:translate(0,0) translateZ(0);transform:translate(0,0) translateZ(0)}'));
    a.head.appendChild(g);_.templateSettings={evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#\{]([\s\S]+?)[^\}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g};a.body.onselectstart=function(){return!1};s?(d.addEventListener("touchstart",c,!1),d.addEventListener("touchmove",l,!1),d.document.body.className+=" ios"):e&&(d.document.body.className+=" android");f.addEventListener("click",b,!1);f.addEventListener("touchstart",b,!1);f.addEventListener("touchmove",b,!1);f.addEventListener("touchend",b,!1)}function q(a){var b=
{};return{channels:function(){return b},publish:function(e){var f,g,k,c,v,n=e.split("."),h;d.RAD.core.isInitialize||d.RAD.core.initialize();f=arguments[1];if("view"===n[0]||"service"===n[0])if(f&&f.autocreate||"view"!==n[0])c=n[0]+"."+n[1],a.getView(c,a.extractExtras(f));a.options.debug&&(f=this?this.moduleID:void 0,d.console.log(f+" publish:",arguments));f=0;for(c=n.length;f<c;f+=1){g=n[0];k=void 0;for(k=1;k<=f;k+=1)g=g+"."+n[k];h=g;if(b[h])for(g=0,k=b[h].length;g<k;g+=1)v=b[h][g],v.callback.apply(v.context,
    arguments),a.options.debug&&(v=v.context.options||v.context,d.console.log("receiver:"+v.viewID+" channel:"+h,arguments))}},subscribe:function(e,f,g){var k=g.viewID;b[e]||(b[e]=[]);b[e].push({context:g||this,callback:f,ID:k});a.options.debug&&d.console.log(k+" subscribe to channel:"+e,arguments);return this},unsubscribe:function(e,f){var g,k,c;if(!f)return this;c=f.viewID;for(g in b)if(b.hasOwnProperty(g))for(k=b[g].length-1;0<=k;k-=1)if((null===e||e===g)&&b[g][k].ID===c&&(a.options.debug&&d.console.log(c+
    " unsubscribe from channel:"+g,arguments),b[g].splice(k,1),e))return this;return this}}}var n={defaultBackstack:!1,backstackType:"custom",defaultAnimation:"slide",animationTimeout:3E3,debug:!1};d.RAD={core:new function(a,c,e){var f=this,g={},k={},d=new q(f);f.options=n;f.register=function(a,f){void 0===k[a]?k[a]={creator:f,instance:null}:e.console.log("You try register already registered module:"+a+"!")};f.registerAll=function(a){var e,b,g,k;e=0;for(b=a.length;e<b;e+=1)for(k in g=a[e],g)g.hasOwnProperty(k)&&
f.register(k,g[k])};f.startViewOrService=function(a,b){var c;k[a].instance||(c=k[a].creator,"function"!==typeof c?e.console.log("Sorry, but "+a+" wasn't registered!"):(k[a].instance=new c({core:f,application:g,viewID:a,extras:b}),this.options.debug&&e.console.log("create: "+a+" with extras:",b)))};f.startPlugin=function(a){k[a].instance||(k[a].instance=k[a].creator(this,a));this.options.debug&&e.console.log("start plugin:",a)};f.stop=function(a,g,c){var n=k[a],H,r,u;if(n&&n.instance){u=n.instance;
    u instanceof e.RAD.Blanks.View&&u.unbindModel();if(u.children)for(r=0,n=u.children.length;r<n;r+=1)f.stop(u.children[r].content,null);e.setTimeout(function(){if(H=k[a].instance)d.unsubscribe(null,H),H.destroy(),k[a].instance=null,b(g,null,c),f.options.debug&&e.console.log("destroy:"+a)},0)}};f.startAll=function(){var a,e;for(a in k)k.hasOwnProperty(a)&&(e=a.split("."),"plugin"===e[0]?this.startPlugin(a):this.startViewOrService(a))};f.stopAll=function(){for(var a in k)k.hasOwnProperty(a)&&this.stop(a)};
    f.extractExtras=function(a){try{return a.extras}catch(e){return null}};f.getView=function(a,b){var g;if(!a)return null;try{g=k[a].instance}catch(c){return e.console.log("Error - not register view:"+a,c),null}if(null===g||void 0===g)f.startViewOrService(a,b);else if(b)try{g.setExtras(b)}catch(d){e.console.log(d)}return k[a].instance};f.getService=f.getView;f.initialize=function(a,e){var b,c;g=a||g;e&&(f.options=e);f.options.plugins&&"[object Array]"===Object.prototype.toString.call(f.options.plugins)&&
    f.registerAll(f.options.plugins);p();for(b in k)k.hasOwnProperty(b)&&(c=b.split("."),"plugin"===c[0]&&this.startPlugin(b));this.isInitialize=!0};f.getStartedViews=function(){var a,e=[];for(a in k)k.hasOwnProperty(a)&&k[a].instance&&e.push(a);return e};f.document=c;f.window=e;f.$=a;f.subscribe=d.subscribe;f.publish=d.publish;f.channels=d.channels;f.unsubscribe=d.unsubscribe;return f}(d.jQuery,a,d),model:function(a,b,e){var f=b,g=a;"function"!==typeof b||void 0!==e&&!0!==e||(f=new b);-1===a.indexOf("RAD.models.")&&
(g="RAD.models."+a);return h(g,f)},application:function(a,b){var e=a;"function"!==typeof a||void 0!==b&&!0!==b||(e=new a(d.RAD.core));return RAD.application=e},namespace:h};h("RAD.view",h("RAD.service",h("RAD.plugin",function(a,b){var e,f;if("[object Array]"===Object.prototype.toString.call(a))for(e=0,f=a.length;e<f;e+=1)d.RAD.core.register(a[e],b);else d.RAD.core.register(a,b)})));h("RAD.views",{});h("RAD.services",{});h("RAD.plugins",{});h("RAD.models",{});h("RAD.utils",{});h("RAD.scriptLoader",
    new function(){function c(e,b){var f=a.createElement("script");f.type="text/javascript";f.async=!0;f.readyState?f.onreadystatechange=function(){if("loaded"===f.readyState||"complete"===f.readyState)f.onreadystatechange=null,b()}:(f.onload=b,f.onerror=b);f.src=e;a.head.appendChild(f)}function n(a,e,d){function h(){p+=1;p===l&&b(e,null,d)}var s,l=a.length,p=0;f.arr=null;f.callback=null;f.context=null;for(s=0;s<l;s+=1)c(a[s],h)}function e(){f.loadScripts=n;f.arr&&f.callback&&f.loadScripts(f.arr,f.callback,
        f.context)}var f=this;f.loadScripts=function(a,e,b){f.arr=a;f.callback=e;f.context=b};d.attachEvent?d.attachEvent("onload",e):d.addEventListener("load",e,!1);return f});h("RAD.Class",function(){function a(e){return"function"===typeof e}var b=function(){};b.extend=function(e){var b,g=function(e){e!==a&&a(this.initialize)&&this.initialize.apply(this,arguments)};g.prototype=new this(a);for(b in e)(function(e,c){g.prototype[b]=a(e)&&a(c)?function(){this._super=c;return e.apply(this,arguments)}:e})(e[b],
    g.prototype[b]);g.prototype.constructor=g;g.extend=this.extend||this.create;return g};return b}())})(document,window);
RAD.namespace("RAD.Blanks.Deferred",function(){return{listeners:[],done:function(a){this.listeners.push(a)},doneFirstTask:function(a){this.firstTask=a},doneLastTask:function(a){this.lastTask=a},resolve:function(){var a,d,b;this.resolve=function(){};this.doneLastTask=this.doneFirstTask=this.done=function(a){"function"===typeof a&&a()};"function"===typeof this.firstTask&&this.firstTask();a=0;for(d=this.listeners.length;a<d;a+=1)b=this.listeners[a],"function"===typeof b&&b();"function"===typeof this.lastTask&&
this.lastTask();delete this.listeners}}});
RAD.namespace("RAD.Blanks.View",Backbone.View.extend({className:"backbone-view",attributes:{"data-role":"view"},listen:"add remove fetch sort change reset".split(" "),getChildren:function(){this.children||(this.children=[]);return this.children},initialize:function(a){function d(a){return a?a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'):a}var b=this,h,m=a.extras;b.loader=RAD.Blanks.Deferred();b.renderRequest=!0;b.viewID=a.viewID;h=a.core;b.publish=h.publish;
    b.subscribe=h.subscribe;b.unsubscribe=h.unsubscribe;b.finish=function(){h.stop(b.viewID)};b.application=a.application;delete b.options;a=_.clone(b.getChildren());b.children=a;b.ajax=$.get(b.url,function(a){var c,h,m,n;if(b.ajax){n=window.$("<div></div>").html(a).find("[data-template]");0<n.length&&(b.innerTemplate=[]);h=0;for(m=n.length;h<m;h+=1)c=n.get(h),c=c.innerHTML,b.innerTemplate[h]=_.template(d(c));b.template=_.template(a);b.bindModel(b.model);b.loader.resolve()}b.ajax=null},"text");b.subscribe(b.viewID,
        b.receiveMsg,b);b.oninit();b.onInitialize();b.setExtras(m);return b},setExtras:function(a){a!==this.extras&&(this.onNewExtras(a),this.extras=a)},bindModel:function(a){var d;if(a){this.model=a;for(d=this.listen.length-1;-1<d;d-=1)this.listenTo(a,this.listen[d],this.render);this.template&&!this.renderRequest&&a.trigger("change")}},unbindModel:function(a){this.model&&(this.stopListening(this.model),this.model=null,a&&this.render())},changeModel:function(a){this.unbindModel();this.bindModel(a)},insertSubview:function(a,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               d){var b=RAD.core.getView(a.content,a.extras),h=this.$(a.container_id);a&&a.backstack&&RAD.core.publish("router.beginTransition",a);b.appendIn(h,function(){h.attr("view",a.content);"function"===typeof a.callback&&("object"===typeof a.context?a.callback.call(a.context):a.callback());"function"===typeof d&&d()})},render:function(a){function d(){l-=1;0>=l&&(b.onrender(),b.onEndRender(),b.initScrollRefresh(),b.renderRequest=!1,"function"===typeof a&&a())}var b=this,h=b.model?b.model.toJSON():void 0,m=
    b.getChildren(),l=m.length,c,p,q;b.onStartRender();c=0;for(p=m.length;c<p;c+=1)RAD.core.getView(m[c].content,m[c].extras).detach();try{if(b.innerTemplate&&!b.renderRequest)for(c=0,p=b.innerTemplate.length;c<p;c+=1)$(b.$inner[c]).html(b.innerTemplate[c].apply(b,[{model:h}]));else if(b.$el.html(b.template({model:h})),b.innerTemplate)for(b.$inner=[],q=b.$("[data-template]"),c=0,p=b.innerTemplate.length;c<p;c+=1)b.$inner[c]=q.get(c)}catch(n){return window.console.log("Error rendering in"+b.viewID+": "+
    n.toString()),b}if(0<m.length)for(c=0,p=m.length;c<p;c+=1)this.insertSubview(m[c],d);else d();return b},appendIn:function(a,d){function b(){h.attachScroll();d()}var h=this,m=$(a);a&&0!==m.length?(m.append(h.$el),h.renderRequest?h.loader.doneFirstTask(function(){h.render(b)}):b()):window.console.log("Container for "+h.viewID+" doesn't exist!")},initScrollRefresh:function(a){a=a||this.el;var d=document.createEvent("Event");d.initEvent("scrollRefresh",!0,!0);a.dispatchEvent(d);this.refreshScroll()},
    receiveMsg:function(a,d){var b=this;switch(a.split(".")[2]){case "attach":b.loader.done(function(){b.onattach();b.onStartAttach(a,d)});break;case "detach":b.ondetach();b.onEndDetach(a,d);break;case "attach_complete":b.loader.doneLastTask(function(){b.onEndAttach(a,d)});break;default:b.onReceiveMsg(a,d)}return b},detach:function(){this.detachScroll();this.$el&&this.$el.detach()},destroy:function(){var a;this.ajax&&(this.ajax.abort(),this.ajax=null);this.onDestroy();this.ondestroy();this.unbindModel();
        this.off(null,null,this);this.unsubscribe(this.viewID,this);this.undelegateEvents();this.$el.removeData().unbind();this.remove();window.Backbone.View.prototype.remove.call(this);for(a in this)this.hasOwnProperty(a)&&delete this[a];return this},oninit:function(){},onattach:function(){this.el.offsetHeight},ondetach:function(){},onrender:function(){},ondestroy:function(){},attachScroll:function(){},refreshScroll:function(){},detachScroll:function(){},onInitialize:function(){},onNewExtras:function(){},
    onReceiveMsg:function(){},onStartRender:function(){},onEndRender:function(){},onStartAttach:function(){},onEndAttach:function(){},onEndDetach:function(){},onDestroy:function(){}}));
RAD.namespace("RAD.Blanks.Service",RAD.Class.extend({initialize:function(a){this.publish=a.core.publish;this.subscribe=a.core.subscribe;this.unsubscribe=a.core.unsubscribe;this.serviceID=this.viewID=a.viewID;this.application=a.application;this.subscribe(this.serviceID,this.onReceiveMsg,this);this.onInitialize()},destroy:function(){this.onDestroy();this.unsubscribe(null,this)},onInitialize:function(){},onReceiveMsg:function(){},onDestroy:function(){}}));
RAD.namespace("RAD.Blanks.ScrollableView",RAD.Blanks.View.extend({className:"scroll-view",offsetY:0,attachScroll:function(){var a=this.el.querySelector(".scroll-view")||this.el;this.mScroll||(this.mScroll=new window.iScroll(a,{bounce:!0,onBeforeScrollStart:function(a){for(var b=a.target;1!==b.nodeType;)b=b.parentNode;"SELECT"!==b.tagName&&"INPUT"!==b.tagName&&"TEXTAREA"!==b.tagName&&a.preventDefault()}}))},onattach:function(){var a=this;window.setTimeout(function(){a.mScroll&&(a.mScroll.refresh(),
    a.mScroll.scrollTo(0,a.offsetY,0))},0)},refreshScroll:function(){this.mScroll&&this.mScroll.refresh()},detachScroll:function(){this.mScroll&&(this.offsetY=this.mScroll.y,this.mScroll.destroy(),this.mScroll=null)}}));
RAD.namespace("RAD.Blanks.Toast",RAD.Blanks.View.extend({className:"toast",closeTimeOut:void 0,showTime:4E3,oninit:function(){var a=this;a.refreshTimeout=function(){clearTimeout(a.closeTimeOut);a.closeTimeOut=window.setTimeout(function(){a.close(a)},a.showTime)}},setExtras:function(a){a!==this.extras&&(this.refreshTimeout(),this.onNewExtras(a),this.extras=a)},close:function(a){a=a||this;var d={content:a.viewID};clearTimeout(a.closeTimeOut);$(document.body).off("click.close");a.publish&&a.publish("navigation.toast.close",
    d)},onattach:function(){var a=this;clearTimeout(a.closeTimeOut);a.closeTimeOut=window.setTimeout(function(){a.close()},a.showTime);$(document.body).one("click.close",function(){a.close()})}}));
RAD.namespace("RAD.Blanks.Popup",RAD.Blanks.ScrollableView.extend({className:"popup",close:function(){var a={content:this.viewID,destroy:this.onCloseDestroy},d;d=this.viewID.split(".");d=d[d.length-1];$(document.body).off("tapdown."+d);$(document.body).off("click."+d);this.publish("navigation.popup.close",a)},onattach:function(a,d){function b(){m.close()}function h(a){a.stopPropagation()}var m=this,l;l=m.viewID.split(".");RAD.Blanks.ScrollableView.prototype.onattach.call(m);l=l[l.length-1];m.outSideClose&&
(m.$el.on("tapdown."+l,h),m.$el.on("click."+l,h),$(document.body).one("tapdown."+l,b),$(document.body).one("click."+l,b));$(window).one("orientationchange."+l,b)},ondetach:function(){var a;a=this.viewID.split(".");a=a[a.length-1];$(document.body).off("tapdown."+a);$(document.body).off("click."+a);this.$el.off("tapdown."+a);this.$el.off("click."+a);$(window).off("orientationchange."+a)}}));
RAD.plugin("plugin.fastclick",function(a){this.swipe=new function(a){function b(a){var b={},d=a;c.touch&&(a.touches&&a.touches[0]&&"touchend"!==a.type?d=a.touches[0]:a.changedTouches&&a.changedTouches[0]&&(d=a.changedTouches[0]));b.screenX=d.screenX;b.screenY=d.screenY;b.clientX=d.clientX;b.clientY=d.clientY;return b}function h(a,b,c,e){return Math.abs(a-c)>Math.abs(b-e)?a>c?"left":"right":b>e?"top":"bottom"}function m(a,c){var d=b(c),e=document.createEvent("Event");e.initEvent(a,!0,!0);e[a]={clientX:d.clientX,
    clientY:d.clientY,screenX:d.screenX,screenY:d.screenY,timeStamp:c.timeStamp};c.target.dispatchEvent(e)}function l(a){var c=b(a);p=q;q={screenX:c.screenX,screenY:c.screenY,timeStamp:a.timeStamp}}var c=this,p,q;c.down=function(a){var d=b(a);c.startX=d.screenX;c.startY=d.screenY;c.startClientX=d.clientX;c.startClientY=d.clientY;c.timeStamp=a.timeStamp;c.moved=!1;c.isDown=!0;c.touchStartTime=(new Date).getTime();p=q={screenX:0,screenY:0,timeStamp:(new Date).getTime()};l(a);m("tapdown",a)};c.move=function(a){var d=
    b(a);c.isDown&&m("tapmove",a);if(20<Math.abs(d.screenX-c.startX)||20<Math.abs(d.screenY-c.startY))c.moved=!0,l(a)};c.cancel=function(a){c.isDown&&(c.touch?c.up(a):m("tapcancel",a))};c.clear=function(a){m("tapclear",a)};c.up=function(a){var d,l=b(a),e,f;f=(new Date).getTime()-c.touchStartTime;if(c.isDown){c.isDown=!1;!c.moved&&400>=f&&m("tap",a);f=l.screenX-p.screenX;e=l.screenY-p.screenY;f=(Math.pow(f*f+e*e,0.5)/(a.timeStamp-p.timeStamp)).toFixed(3);if(c.moved&&0<f){e=p.screenX;var g=p.screenY,k=
    p.timeStamp,t=l.screenX,q=l.screenY,B=a.timeStamp;switch(h(e,g,t,q)){case "left":d=e-t;break;case "right":d=t-e;break;case "top":d=g-q;break;case "bottom":d=q-g}e=(d/(B-k)).toFixed(3);d=document.createEvent("Event");d.initEvent("swipe",!0,!0);d.swipe={start:{screenX:c.startX,screenY:c.startY,clientX:c.startClientX,clientY:c.startClientY,timeStamp:c.timeStamp},end:{screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY,timeStamp:a.timeStamp},velocity:f,direction:h(c.startX,c.startY,
    l.screenX,l.screenY),speed:e};a.target.dispatchEvent(d)}m("tapup",a)}};c.destroy=function(){this.touch?(this.el.removeEventListener("touchstart",this.down),this.el.removeEventListener("touchend",this.up),this.el.removeEventListener("touchmove",this.move),this.el.removeEventListener("touchcancel",this.cancel)):(this.el.removeEventListener("mousedown",this.down),this.el.removeEventListener("mouseup",this.up),this.el.removeEventListener("mousemove",this.move),this.el.removeEventListener("mouseout",this.cancel),
    this.el.removeEventListener("mouseover",this.clear));delete this.el};c.el=a;a=null;c.touch=void 0!==window.ontouchstart;c.touch?(c.el.addEventListener("touchstart",c.down,!1),c.el.addEventListener("touchend",c.up,!1),c.el.addEventListener("touchmove",c.move,!1),c.el.addEventListener("touchcancel",c.cancel,!1)):(c.el.addEventListener("mousedown",c.down,!1),c.el.addEventListener("mouseup",c.up,!1),c.el.addEventListener("mousemove",c.move,!1),c.el.addEventListener("mouseout",c.cancel,!1),c.el.addEventListener("mouseover",
    c.clear,!1));return c}(a.document.body);return this});
RAD.plugin("plugin.navigator",function(a,d){function b(a,e,b){"function"===typeof a&&("object"===typeof e?a.apply(e,[b]):a(b))}function h(a,e){var b,f=a.querySelector(e);f&&f.getAttribute&&(b=f.getAttribute("view"));return b}function m(e){function b(a){if(!a||!a.parentNode)return null;if((a=a.parentNode)&&a.getAttribute)return(f=a.getAttribute("view"))?f:b(a)}var f;return b(a.document.querySelector(e))}function l(e){var b,f,c,g,d,k=[];if(!e)return k;e=e.getChildren();c=0;for(g=e.length;c<g;c+=1)for(b=
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            e[c].content,k.push(b),d=l(a.getView(b)),b=0,f=d.length;b<f;b+=1)k.push(d[b]);return k}function c(a,b,f,c,g){var d=e.innerWidth,k=e.innerHeight,h=c||150,l=g||150,m=0,n=0,p=$(b),t=p.offset().top,q=p.offset().left,s=p.outerWidth(),p=p.outerHeight(),v=f&&0<f.length&&-1!=="top bottom left right center".indexOf(f),r=e.getComputedStyle(a),y=a.querySelector(".popup-pointer"),D=0,D=0;v||(f="center",h<q-0&&l<k-0&&(f="left"),h<d-0&&l<k-(t+p)&&(f="bottom"),h<d-(q+s)&&l<k-0&&(f="right"),h<d-0&&l<t-0&&(f="top"));
    switch(f){case "center":m=(d-h)/2;n=(k-l)/2;break;case "top":m=q-h/2+s/2;n=t-l;break;case "bottom":m=q-h/2+s/2;n=t+p;break;case "left":n=t-l/2+p/2;m=q-h;break;case "right":n=t-l/2+p/2,m=q+s}a.style.left=Math.round(m+e.pageXOffset)+"px";a.style.top=Math.round(n+e.pageYOffset)+"px";a.style.width=c+"px";a.style.height=g+"px";if(y){y.style.top="";y.style.left="";y.className="popup-pointer "+f;if("top"===f||"bottom"===f)D=y.offsetWidth/2+parseInt(r.paddingLeft,10),y.style.left=q+Math.round(b.offsetWidth/
        2)-m-D+"px";if("left"===f||"right"===f)D=y.offsetHeight/2+parseInt(r.paddingTop,10),y.style.top=t+Math.round(b.offsetHeight/2)-n-D+"px"}}function p(a,b){var f=0,c=0,g=a.offsetWidth,d=a.offsetHeight,k=e.innerWidth,h=e.innerHeight;switch(b){case "center":f=(k-g)/2;c=(h-d)/2;break;case "left":c=(h-d)/2;break;case "right":f=k-g;c=(h-d)/2;break;case "bottom":f=(k-g)/2;c=h-d;break;default:f=(k-g)/2}a.style.left=Math.round(f+e.pageXOffset)+"px";a.style.top=Math.round(c+e.pageYOffset)+"px"}function q(d,h){var u=
    a.getView(d.content,a.extractExtras(d)),l,m,n=!1;if(null!==u&&void 0!==u&&!u.isShown){u.isShown=!0;d.animation&&(u.animation=d.animation);l=u.$el;m=function(){n||(n=!0,b(d.callback,d.context,u),t.removeClass("show"),l.off(k,m),l.off("cssClassChanged",m),a.publish(d.content+".attach_complete",null),u=null)};if("none"===u.animation||"none"===f&&!u.animation||G)l.on("cssClassChanged",m);else l.addClass("animate"),l.on(k,m);t.addClass("show");e.setTimeout(m,g);u.appendIn("body",function(){l.attr("id",
    d.content);switch(h){case "dialog":l.addClass("lightbox");break;case "toast":p(u.el,d.gravity);break;case "popup":c(u.el,d.target,d.gravity,d.width,d.height)}l.width();e.setTimeout(function(){a.publish(d.content+".attach",null);l.trigger("cssClassChanged")},0);l.addClass("show")})}}function n(c){var d=a.getView(c.content),h=d.$el,l,m=!1;e.document.activeElement&&e.document.activeElement.blur();l=function(){m||(m=!0,d.detach(),b(c.callback,c.context,d),t.removeClass("show"),h.removeClass("animate"),
    h.off(k,l),h.off("cssClassChanged",l),a.publish(c.content+".detach",null),c&&void 0!==c.destroy&&!0!==c.destroy?d.isShown=!1:a.stop(c.content),d=null)};t.addClass("show");if("none"===d.animation||"none"===f&&!d.animation||G)h.on("cssClassChanged",l);else h.on(k,l);e.setTimeout(function(){l()},g);h.removeClass("show");e.setTimeout(function(){h.trigger("cssClassChanged")},0)}function r(b,e){function f(e){var b=e?e.backstack:void 0;(b||v&&void 0===b)&&a.publish("router.beginTransition",e)}var c=b.split("."),
    d;switch(c[1]){case "show":if("[object Array]"===Object.prototype.toString.call(e))for(c=0,d=e.length;c<d;c+=1)f(e[c]),z.animate(e[c],!1);else f(e),z.animate(e,!1);break;case "back":c=void 0!==e.direction?e.direction:!0;z.animate(e,c);break;case "toast":case "popup":case "dialog":switch(c[2]){case "show":q(e,c[1]);break;case "close":n(e)}}}var s={},e=a.window,f=a.options.defaultAnimation||"slide",g=a.options.animationTimeout||1E3,k="transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd animationend webkitAnimationEnd oanimationend MSAnimationEnd",
    t,v=a.options&&void 0!==a.options.defaultBackstack?a.options.defaultBackstack:!1,B,G=!1,z;/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(B=new Number(RegExp.$1),10>B&&(G=!0));z=new function(){function c(e,b){var f,d;f=0;for(d=b.length;f<d;f+=1)a.publish(b[f]+"."+e)}var d={inAnimation:0,animate:function(g,n){function p(){r&&r.el&&(e.getComputedStyle(r.el,null).getPropertyValue("left"),c("attach",F));r||x?C.addClass("animate"):t.removeClass("show")}function q(){d.inAnimation-=1;0===d.inAnimation&&t.removeClass("show");
    b(g.callback,g.context,[r,x]);c("detach",y);c("attach_complete",F);a.publish("router.endTransition",g)}var s,v,r,x,C,w,A,z="",B,J=!1,F,y=[],D,I,E,K;e.document.activeElement&&e.document.activeElement.blur();if(null!==g&&void 0!==g)if(A=g.animation||f,C=a.$(g.container_id),r=a.getView(g.content,a.extractExtras(g)),(x=(w=C.attr("view"))?a.getView(w):void 0)&&x.viewID===(r&&r.viewID))e.console.log("You try navigate the same view:"+x.viewID+" as old and new widget!");else{if(w=h(a.document,g.container_id))y=
    l(a.getView(w)),y.push(w);F=l(r);F.push(g.content);if(w=m(g.container_id)){w=a.getView(w);w=w.getChildren();I={container_id:g.container_id,content:g.content,animation:g.animation};if(w)for(E=0,K=w.length;E<K;E+=1)if(D=w[E],D.container_id===I.container_id){w.splice(E,1);break}w.push(I)}C.attr("view",g.content);s=r?r.$el:void 0;v=x?x.$el:void 0;t.addClass("show");d.inAnimation+=1;"none"===g.animation||"none"===f&&!g.animation||G?(x&&x.detach(),s&&r.appendIn(g.container_id,function(){c("attach",F)}),
    q()):(B=function(a){a=a&&(r&&a.target===r.el||x&&a.target===x.el);!J&&a&&(C.removeClass("animate"),s&&s.removeClass("new-page "+z),v&&(v.removeClass("old-page "+z),x.detach()),C.off(k,B),q(),J=!0)},C.on(k,B),e.setTimeout(B,4E3),z=n?-1!==A.indexOf("-out")?A.replace("-out","-in"):-1!==A.indexOf("-in")?A.replace("-in","-out"):A+"-out":-1!==A.indexOf("-out")||-1!==A.indexOf("-in")?A:A+"-in",v&&v.addClass("old-page "+z),s?(s.addClass("new-page "+z),r.appendIn(C,p)):p())}}};return d};a.subscribe("navigation",
    r,s);t=a.$("#overlay");s.viewID=d;s.destroy=function(){a.unsubscribe(r,s)};return s});
RAD.plugin("plugin.router",function(a,d){function b(a){var f,c,d;f=a.childNodes;c=0;for(d=f.length;c<d;c+=1)if(f[c].getAttribute&&(a=f[c].getAttribute("view")))return{content:a,container_id:"#"+f[c].getAttribute("id")};c=0;for(d=f.length;c<d;c+=1)if(a=b(f[c]))return a}function h(e){var b,c,d,l,m=[];if(!e)return m;e=e.getChildren();b=0;for(c=e.length;b<c;b+=1)l=_.clone(e[b]),m.push(l),d=l.content,(d=h(a.getView(d)))&&0<d.length&&(l.children=d);m.sort(function(a,b){var e=a.container_id,f=b.container_id,
    c=0;e>f?c=1:e<f&&(c=-1);return c});return m}function m(a,b,c){return encodeURIComponent(JSON.stringify(a)).replace(/[!'()]/g,escape).replace(/\*/g,"%2A")+"$$$"+b+"$$$"+c}function l(a){var b={};a=a.split("$$$");b.urlObj=JSON.parse(decodeURIComponent((a[0]+"").replace(/\+/g,"%20")));b.timestamp=a[1];b.animation=a[2];return b}function c(a,b){switch(a.split(".")[1]){case "beginTransition":q.onNewTransition();break;case "endTransition":q.pushToStackRequest&&q.saveScoopeAsURL(b);break;case "back":q.back();
    break;case "clear":q.clearAndBlock()}}var p={},q,n=[],r=!1,s=function(a){var b="function"===typeof history.pushState?"native":"hashbang",c=["native","hashbang","custom"];a&&0<c.indexOf(a)&&(b=a);return b}(a.options.backstackType);q={currentID:Math.floor(1E5*Math.random()),currentURL:void 0,lastURL:void 0,toBack:!0,isBlocked:!1,stack:new function(){var a,b=-1,c=[];this.push=function(d){var h;b!==c.length-1&&(h=b+1,c=c.slice(0,h));void 0!==a&&null!==a&&c.push(a);a=d;b=c.length-1};this.getCurrent=function(){return void 0!==
    a&&null!==a?a:c[b]};this.getNext=function(){var a,e;a=b+1;-1<a&&a<c.length&&(e=c[a],b=a);return e};this.getPrevious=function(){var d,h;a&&(c.push(a),b=c.length-1,a=null);d=b-1;-1<d&&d<c.length&&(h=c[d],b=d);return h};this.clear=function(){a=null;c=[];b=c.length-1};return this},pushToStackRequest:!1,navigate:function(a){switch(s){case "native":history.pushState({url:a,id:this.currentID},null,null);break;case "hashbang":r=!0;window.location.href="index.html#!"+a+"%%%"+this.currentID;break;case "custom":n.last&&
    n.push(n.last),n.last={state:{url:a,id:this.currentID}}}this.currentURL=this.lastURL=a;this.pushToStackRequest=!1;this.stack.push(a)},saveScoopeAsURL:function(c){var f=+(new Date).getTime(),d=b(document.getElementsByTagName("body")[0]),k=a.getView(d.content);c=c.animation?c.animation:a.options.defaultAnimation;(k=h(k))&&0<k.length&&(d.children=k);this.navigate(m(d,f,c))},onNewTransition:function(){this.toBack=!0;this.isBlocked=!1;this.pushToStackRequest=!0},back:function(){this.toBack=!0;switch(s){case "native":case "hashbang":history.back();
    break;case "custom":var a=n.pop();if(a)q.onPopState(a)}},clearAndBlock:function(){this.isBlocked=this.toBack=!0;this.lastURL=this.currentURL=void 0;this.currentID=Math.floor(1E5*Math.random());this.stack.clear();n=[];n.last=null},extractDiffer:function(a,b){var c,d,h;for(c in a)if(a.hasOwnProperty(c)&&"children"!==c&&a[c]!==b[c])return delete b.children,b;if(a.hasOwnProperty("children"))for(c=0,d=a.children.length;c<d&&!(h=this.extractDiffer(a.children[c],b.children[c]));c+=1);return h},onPopState:function(b){var c,
    d;c=!1;d=this.toBack;b.state&&b.state.id===this.currentID&&this.currentURL&&!this.isBlocked&&(this.lastURL&&this.lastURL===b.state.url&&(c=!0,d=!d),b=d?this.stack.getPrevious():this.stack.getNext(),d=this.toBack?"back":"forward",b?(c&&(this.toBack=!this.toBack),c=this.extractDiffer(l(this.currentURL).urlObj,l(b).urlObj),c.direction=this.toBack,c.animation=this.toBack?l(this.currentURL).animation:l(b).animation,a.publish("navigation.back",c),this.lastURL=this.currentURL,this.currentURL=b,c.direction=
    d,a.publish("backstack.pop",c)):a.publish("backstack.empty",{direction:d}))}};p.viewID=d;a.subscribe("router",c,p);switch(s){case "native":a.window.onpopstate=function(a){q.onPopState(a)};break;case "hashbang":$(window).bind("hashchange",function(){var a=window.location.href.substring(window.location.href.lastIndexOf("#!")+2).split("%%%"),b=a[0],a=parseInt(a[1],10);if(!r)q.onPopState({state:{id:a,url:b}});r=!1})}p.destroy=function(){a.unsubscribe(c,p)};return p});